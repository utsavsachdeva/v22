<!DOCTYPE html>
<html>
<head>
    <title>Campaign Activity Report</title>
    <style>
        /* Basic styling for the report */
        body {
            font-family: sans-serif;
        }

        h1, h2 {
            text-align: center;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        th, td {
            padding: 8px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }

        th {
            background-color: #f2f2f2;
        }

        .chart-container {
            width: 500px; /* Adjust as needed */
            height: 300px; /* Adjust as needed */
            margin: 20px auto;
        }
    </style>
</head>
<body>

    <h1>Campaign Activity Report</h1>
    <h2>{{ start_date }} - {{ end_date }}</h2>

    <table>
        <thead>
            <tr>
                <th>Campaign ID</th>
                <th>Campaign Name</th>
                <th>Start Date</th>
                <th>End Date</th>
                <th>Budget</th>
                <th>Total Ad Requests</th>
                <th>Accepted Ad Requests</th>
                <th>Pending Ad Requests</th>
                <th>Total Reach</th>
                <th>Total Spend</th>
                <th>Avg. Payment per Influencer</th>
            </tr>
        </thead>
        <tbody>
            {% for campaign in report_data %}
            <tr>
                <td>{{ campaign.campaign_id }}</td>
                <td>{{ campaign.campaign_name }}</td>
                <td>{{ campaign.start_date }}</td>
                <td>{{ campaign.end_date }}</td>
                <td>${{ campaign.budget }}</td>
                <td>{{ campaign.total_ad_requests }}</td>
                <td>{{ campaign.accepted_ad_requests }}</td>
                <td>{{ campaign.pending_ad_requests }}</td>
                <td>{{ campaign.total_reach }}</td>
                <td>${{ campaign.total_spend }}</td>
                <td>${{ campaign.avg_payment_per_influencer }}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>

    <div class="chart-container">
        <canvas id="budget-vs-spend-chart"></canvas>
    </div>

    <div class="chart-container">
        <canvas id="ad-requests-chart"></canvas>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        // Convert Jinja2 variables to JSON safely
        const chartLabels = JSON.parse('{{ chart_labels | tojson | safe }}');
        const budgetData = JSON.parse('{{ budget_data | tojson | safe }}');
        const totalSpendData = JSON.parse('{{ total_spend_data | tojson | safe }}');
        const totalAdRequestsData = JSON.parse('{{ total_ad_requests_data | tojson | safe }}');
        const acceptedAdRequestsData = JSON.parse('{{ accepted_ad_requests_data | tojson | safe }}');
        const pendingAdRequestsData = JSON.parse('{{ pending_ad_requests_data | tojson | safe }}');

        const budgetVsSpendData = {
            labels: chartLabels,
            datasets: [{
                label: 'Budget',
                data: budgetData,
                backgroundColor: 'rgba(54, 162, 235, 0.2)',
                borderColor: 'rgba(54, 162, 235, 1)',
                borderWidth: 1
            }, {
                label: 'Total Spend',
                data: totalSpendData,
                backgroundColor: 'rgba(255, 99, 132, 0.2)',
                borderColor: 'rgba(255, 99, 132, 1)',
                borderWidth: 1
            }]
        };

        const adRequestsData = {
            labels: chartLabels,
            datasets: [{
                label: 'Total Ad Requests',
                data: totalAdRequestsData,
                backgroundColor: 'rgba(75, 192, 192, 0.2)',
                borderColor: 'rgba(75, 192, 192, 1)',
                borderWidth: 1
            }, {
                label: 'Accepted Ad Requests',
                data: acceptedAdRequestsData,
                backgroundColor: 'rgba(153, 102, 255, 0.2)',
                borderColor: 'rgba(153, 102, 255, 1)',
                borderWidth: 1
            }, {
                label: 'Pending Ad Requests',
                data: pendingAdRequestsData,
                backgroundColor: 'rgba(255, 159, 64, 0.2)',
                borderColor: 'rgba(255, 159, 64, 1)',
                borderWidth: 1
            }]
        };

        // Create the charts (only if there is data)
        if (chartLabels && chartLabels.length > 0) {
            const budgetVsSpendChart = new Chart(
                document.getElementById('budget-vs-spend-chart'),
                {
                    type: 'bar',
                    data: budgetVsSpendData,
                    options: {
                        scales: {
                            y: {
                                beginAtZero: true
                            }
                        }
                    }
                }
            );

            const adRequestsChart = new Chart(
                document.getElementById('ad-requests-chart'),
                {
                    type: 'bar',
                    data: adRequestsData,
                    options: {
                        scales: {
                            y: {
                                beginAtZero: true
                            }
                        }
                    }
                }
            );
        } else {
            // Handle the case where there's no data for the charts
            console.log('No data available for charts.');
            // You might want to display a message in the chart containers or take other actions
        }
    </script>

</body>
</html>
